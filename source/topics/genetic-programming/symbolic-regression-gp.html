

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>13. Symbolic Regression with Genetic Programming &mdash; CSCI 340 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=fa70396c" />

  
    <link rel="shortcut icon" href="../../_static/duck_face.ico"/>
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="14. Experimenting with Symbolic Regression" href="symbolic-regression-gp-experiment.html" />
    <link rel="prev" title="12. Genetic Programming" href="genetic-programming.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            CSCI 340
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Course Notes</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/intro.html">1. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genetic-algorithms/simple-ga.html">2. Implementing a Genetic Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genetic-algorithms/simple-ga-experiment.html">3. Experimenting with a Genetic Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/problems.html">4. Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../origin/origin.html">5. Origin</a></li>
<li class="toctree-l1"><a class="reference internal" href="../overview/overview.html">6. Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../representation/representation.html">7. Representation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genetic-algorithms/n-queens-ga.html">8. <span class="math notranslate nohighlight">\(n\)</span> Queens Genetic Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genetic-algorithms/n-queens-ga-experiment.html">9. Experimenting with the <span class="math notranslate nohighlight">\(n\)</span> Queens Genetic Algorithm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../genetic-operators/genetic-operators.html">10. Genetic Operators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../selection/selection.html">11. Selection and Population Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="genetic-programming.html">12. Genetic Programming</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">13. Symbolic Regression with Genetic Programming</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#problem-regression-analysis">13.1. Problem — Regression Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#linear-regression-on-nonlinear-relationships">13.1.1. Linear Regression on Nonlinear Relationships</a></li>
<li class="toctree-l3"><a class="reference internal" href="#symbolic-regression">13.1.2. Symbolic Regression</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#deap">13.2. DEAP</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data">13.3. Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#evaluation">13.4. Evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#language">13.5. Language</a></li>
<li class="toctree-l2"><a class="reference internal" href="#deap-setup">13.6. DEAP Setup</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#bloat-control">13.6.1. Bloat Control</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bookkeeping">13.6.2. Bookkeeping</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#running-and-results">13.7. Running and Results</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#funny-results">13.7.1. Funny Results</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#for-next-class">13.8. For Next Class</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="symbolic-regression-gp-experiment.html">14. Experimenting with Symbolic Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters/tuning.html">15. Tuning Hyperparameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../parameters/comparing.html">16. What Comparing Distributions <em>Means</em></a></li>
<li class="toctree-l1"><a class="reference internal" href="../problems/multi-objective.html">17. Multi-Objective Problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../particle-swarm-optimization/pso.html">18. Particle Swarm Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../particle-swarm-optimization/simple-pso.html">19. Implementing PSO</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Student Lectures</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../student-lectures/description.html">1. Student Lecture Task Description</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../student-lectures/Ant%20Colony%20Optimization/Ant%20Colony%20Optimization.html">2. Ant Colony Optimization (ACO)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Student Projects</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../student-projects/description.html">1. Project Description</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Assignments</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../assignments/tsp/tsp.html">1. Travelling Salesperson Problem</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../assignments/gp/gp.html">2. Genetic Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../assignments/pso/pso.html">3. Particle Swarm Optimization</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Outline</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../outline/outline.html">Computer Science 340 — Evolutionary Computation</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">CSCI 340</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><span class="section-number">13. </span>Symbolic Regression with Genetic Programming</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/topics/genetic-programming/symbolic-regression-gp.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="symbolic-regression-with-genetic-programming">
<h1><span class="section-number">13. </span>Symbolic Regression with Genetic Programming<a class="headerlink" href="#symbolic-regression-with-genetic-programming" title="Link to this heading"></a></h1>
<ul class="simple">
<li><p>The purpose of this topic is to perform symbolic regression with genetic programming</p></li>
<li><p>The genetic programming system being used is DEAP (Distributed Evolutionary Algorithms in Python)</p></li>
<li><p>Much of the heavy lifting required to implement a genetic programming algorithm is managed by DEAP</p></li>
</ul>
<section id="problem-regression-analysis">
<h2><span class="section-number">13.1. </span>Problem — Regression Analysis<a class="headerlink" href="#problem-regression-analysis" title="Link to this heading"></a></h2>
<ul>
<li><p>Regression is finding the relationships between dependent and independent variables given some observations</p></li>
<li><p>A common and simple form of regression is <em>linear regression</em></p>
<blockquote>
<div><ul class="simple">
<li><p>Find a <em>linear</em> relationship between some dependent and independent variables</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<figure class="align-center" id="id1">
<a class="reference internal image-reference" href="../../_images/regression_linear_data.png"><img alt="../../_images/regression_linear_data.png" src="../../_images/regression_linear_data.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">Observations of some phenomenon plotted in two dimensions. The dependent variable is plotted along the y-axis and
the independent variable is along the x-axis. From a quick glance, this data clearly has some linear relationship.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p>Given the above observations, the goal is to draw a <em>line of best fit</em></p>
<blockquote>
<div><ul class="simple">
<li><p>Which should look a lot like <span class="math notranslate nohighlight">\(y = mx + b\)</span></p></li>
</ul>
</div></blockquote>
</li>
<li><p>The mathematics behind finding this line is interesting, but outside the scope of this course</p></li>
<li><p><a class="reference external" href="https://scikit-learn.org/stable/modules/generated/sklearn.linear_model.LinearRegression.html">Fortunately, scikit-learn provides a way to find this line</a></p></li>
</ul>
<figure class="align-center" id="id2">
<a class="reference internal image-reference" href="../../_images/regression_linear_data_linear_model.png"><img alt="../../_images/regression_linear_data_linear_model.png" src="../../_images/regression_linear_data_linear_model.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">Linear model plotted on top of the observations. The resulting model is <span class="math notranslate nohighlight">\(\hat{y} = 0.999885x + 0.997937\)</span> and
has an <span class="math notranslate nohighlight">\(R^{2}\)</span> value of <span class="math notranslate nohighlight">\(0.9999885\)</span>.</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p>The linearly regressed model for the above observations is <span class="math notranslate nohighlight">\(\hat{y} = 0.999885x + 0.997937\)</span></p>
<blockquote>
<div><ul class="simple">
<li><p>Note that <span class="math notranslate nohighlight">\(\hat{y}\)</span> denotes that it is not <span class="math notranslate nohighlight">\(y\)</span>, but only a prediction/estimation of <span class="math notranslate nohighlight">\(y\)</span></p></li>
</ul>
</div></blockquote>
</li>
<li><p>This particular model has an <span class="math notranslate nohighlight">\(R^{2}\)</span> of <span class="math notranslate nohighlight">\(0.9999885\)</span></p>
<blockquote>
<div><ul class="simple">
<li><p>This is a measure of <em>goodness</em></p></li>
<li><p>The closer to 1.0, the better the fit</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<section id="linear-regression-on-nonlinear-relationships">
<h3><span class="section-number">13.1.1. </span>Linear Regression on Nonlinear Relationships<a class="headerlink" href="#linear-regression-on-nonlinear-relationships" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>With linear regression, trouble arises when the observed data has nonlinear relationships</p></li>
<li><p>It is still possible to find a high-quality model, but it would require several assumptions and a lot of guesswork</p></li>
</ul>
<figure class="align-center" id="id3">
<a class="reference internal image-reference" href="../../_images/regression_nonlinear_data.png"><img alt="../../_images/regression_nonlinear_data.png" src="../../_images/regression_nonlinear_data.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">Observed data with clear nonlinear relationships. The data appears to be parabolic or hyperbolic, but may be neither
depending on which segment of the function was observed. It is not possible to effectively fit a straight line to
describe the relationship between the dependent and independent variable.</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p>Nevertheless, looking for a linear model for such nonlinear data is doomed to fail</p></li>
</ul>
<figure class="align-center" id="id4">
<a class="reference internal image-reference" href="../../_images/regression_nonlinear_data_linear_model.png"><img alt="../../_images/regression_nonlinear_data_linear_model.png" src="../../_images/regression_nonlinear_data_linear_model.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">Linear model generated with linear regression on the nonlinear data. The resulting model is
<span class="math notranslate nohighlight">\(\hat{y} = -3.070395x + 916.550675\)</span>, which has an <span class="math notranslate nohighlight">\(R^{2} = 0.010924\)</span>. Although this is the best possible
straight line that fits this data, it is clear that it is not effectively fitting the data due to the limitation of
the modelling strategy.</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
<section id="symbolic-regression">
<h3><span class="section-number">13.1.2. </span>Symbolic Regression<a class="headerlink" href="#symbolic-regression" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>An alternative strategy is something called <em>symbolic regression</em></p></li>
<li><p>It is a form of regression analysis that requires fewer assumptions and works with nonlinear data</p></li>
<li><p>By using symbolic regression, the underlying nonlinear relationships may be found</p></li>
</ul>
<figure class="align-center" id="id5">
<a class="reference internal image-reference" href="../../_images/regression_nonlinear_data_nonlinear_model.png"><img alt="../../_images/regression_nonlinear_data_nonlinear_model.png" src="../../_images/regression_nonlinear_data_nonlinear_model.png" style="width: 500px;" /></a>
<figcaption>
<p><span class="caption-text">Nonlinear model found with symbolic regression. The model is <span class="math notranslate nohighlight">\(\hat{y} = 1.100511x^{2} - 4.439578\)</span> and has
a mean squared error of <span class="math notranslate nohighlight">\(0.162087\)</span>.</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p>It is clear that <span class="math notranslate nohighlight">\(\hat{y} = 1.100511x^{2} - 4.439578\)</span> effectively describes the relationships in the data</p></li>
<li><p>The <em>mean squared error</em> is <span class="math notranslate nohighlight">\(0.162087\)</span></p>
<blockquote>
<div><ul class="simple">
<li><p>This is not the same as <span class="math notranslate nohighlight">\(R^{2}\)</span></p></li>
<li><p>With mean squared error, a value closer to 0.0 is better</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In reality, symbolic regression produced <code class="docutils literal notranslate"><span class="pre">add(add(protected_divide(mul(x,</span> <span class="pre">x),</span> <span class="pre">9.949161),</span> <span class="pre">mul(x,</span> <span class="pre">x)),</span> <span class="pre">-4.439578)</span></code>,
which was simplified to <span class="math notranslate nohighlight">\(\hat{y} = 1.100511x^{2} - 4.439578\)</span>.</p>
</div>
</section>
</section>
<section id="deap">
<h2><span class="section-number">13.2. </span>DEAP<a class="headerlink" href="#deap" title="Link to this heading"></a></h2>
<ul>
<li><p>Due to the complexity, it is not common to implement genetic programming from scratch</p></li>
<li><p>Instead, a genetic programming system will be used, which does much of the heavy lifting for the user</p></li>
<li><p>Many systems exist in various programming languages</p></li>
<li><p><a class="reference external" href="https://deap.readthedocs.io/en/master/">DEAP is a framework for evolutionary computation algorithms in Python</a></p>
<blockquote>
<div><ul class="simple">
<li><p>Distributed Evolutionary Algorithms in Python — DEAP</p></li>
<li><p>It’s a package for implementing evolutionary computation algorithms</p></li>
</ul>
</div></blockquote>
</li>
<li><p>DEAP is not only for genetic programming, but many evolutionary computation algorithms</p></li>
<li><p>It includes algorithm and tools for implementing multiple types of algorithms, enhancements, and analysis</p></li>
<li><p>Although any genetic program could be used, DEAP will be used here</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://github.com/deap/deap">The GitHub page is available here</a></p></li>
<li><p>It is encouraged to contribute to the repository if possible</p></li>
</ul>
</div></blockquote>
</li>
<li><p>It is strongly recommended to have a look at DEAP’s documentation</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference external" href="https://deap.readthedocs.io/en/master/tutorials/advanced/gp.html">It includes a description of genetic programming with DEAP</a></p></li>
<li><p><a class="reference external" href="https://deap.readthedocs.io/en/master/examples/gp_symbreg.html">It also has a guided tutorial on how to perform symbolic regression with DEAP</a></p></li>
<li><p><a class="reference external" href="https://github.com/DEAP/deap/tree/master/examples/gp">Further, additional and more advanced tutorials can be found here</a></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="data">
<h2><span class="section-number">13.3. </span>Data<a class="headerlink" href="#data" title="Link to this heading"></a></h2>
<ul>
<li><p>The data being used will be tabular</p>
<blockquote>
<div><ul class="simple">
<li><p>Rows of observations</p></li>
<li><p>Columns of variables</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Below is an example of how the data would look</p></li>
</ul>
<table class="docutils align-default" id="id6">
<caption><span class="caption-text">Arbitrary Example Data for Regression Analysis</span><a class="headerlink" href="#id6" title="Link to this table"></a></caption>
<colgroup>
<col style="width: 33.3%" />
<col style="width: 33.3%" />
<col style="width: 33.3%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>ARG1 (<span class="math notranslate nohighlight">\(X_1\)</span>)</p></th>
<th class="head"><p>ARG2 (<span class="math notranslate nohighlight">\(X_2\)</span>)</p></th>
<th class="head"><p>ARG3 (<span class="math notranslate nohighlight">\(y\)</span>)</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>-3.16833493e+01</p></td>
<td><p>3.63253949e+01</p></td>
<td><p>-5.75550374e+02</p></td>
</tr>
<tr class="row-odd"><td><p>-3.59771849e+01</p></td>
<td><p>1.63633781e+01</p></td>
<td><p>-2.94238014e+02</p></td>
</tr>
<tr class="row-even"><td><p>4.35235243e+01</p></td>
<td><p>-1.54189209e+01</p></td>
<td><p>-3.35451435e+02</p></td>
</tr>
<tr class="row-odd"><td><p>4.19705508e+01</p></td>
<td><p>1.25491733e+01</p></td>
<td><p>2.63416737e+02</p></td>
</tr>
<tr class="row-even"><td><p>…</p></td>
<td><p>…</p></td>
<td><p>…</p></td>
</tr>
</tbody>
</table>
<ul>
<li><p>For this example, the data is provided in CSV files</p></li>
<li><p>The data is formatted such that the last column is always the dependant variable</p>
<blockquote>
<div><ul class="simple">
<li><p>Thus, all proceeding columns are independent variables</p></li>
</ul>
</div></blockquote>
</li>
<li><p>This data was generated by some phenomenon</p></li>
<li><p>The goal is to find a model that effectively describes the relationships between the data</p></li>
<li><p>Loading this data can be done as follows</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 97</span>    <span class="n">data_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">RELATIVE_RESOURCES</span><span class="p">,</span> <span class="n">DATA_FILE</span><span class="p">))</span>
<span class="linenos"> 98</span>    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data_file</span><span class="p">]</span>
<span class="linenos"> 99</span>    <span class="n">independent_variables</span> <span class="o">=</span> <span class="p">[</span><span class="n">observation</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">observation</span> <span class="ow">in</span> <span class="n">all_data</span><span class="p">]</span>
<span class="linenos">100</span>    <span class="n">dependent_variable</span> <span class="o">=</span> <span class="p">[</span><span class="n">observation</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">observation</span> <span class="ow">in</span> <span class="n">all_data</span><span class="p">]</span>
</pre></div>
</div>
<ul>
<li><p>The above code loads the data specified in some constants</p></li>
<li><p>The independent variables will be stored in a two dimensional list</p>
<blockquote>
<div><ul class="simple">
<li><p>Rows are observations</p></li>
<li><p>Columns are different independent variables</p></li>
</ul>
</div></blockquote>
</li>
<li><p>The dependent variable is stored in a one dimensional list</p>
<blockquote>
<div><ul class="simple">
<li><p>Each value corresponds to the independent variables at the same index</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Following the example data in the above table, the values would be stored as follows</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">independent_variables</span> <span class="o">=</span> <span class="p">[[</span><span class="o">-</span><span class="mf">3.16833493e+01</span><span class="p">,</span> <span class="mf">3.63253949e+01</span><span class="p">],</span>
                        <span class="p">[</span><span class="o">-</span><span class="mf">3.59771849e+01</span><span class="p">,</span> <span class="mf">1.63633781e+01</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">4.35235243e+01</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.54189209e+01</span><span class="p">],</span>
                        <span class="p">[</span><span class="mf">4.19705508e+01</span><span class="p">,</span> <span class="mf">1.25491733e+01</span><span class="p">],</span>
                        <span class="o">...</span> <span class="p">]</span>

<span class="n">dependant_variable</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">5.75550374e+02</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.94238014e+02</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.35451435e+02</span><span class="p">,</span> <span class="mf">2.63416737e+02</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="evaluation">
<h2><span class="section-number">13.4. </span>Evaluation<a class="headerlink" href="#evaluation" title="Link to this heading"></a></h2>
<ul>
<li><p>A common mechanism for evaluating genetic programming performing symbolic regression is <em>mean squared error</em></p>
<blockquote>
<div><ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\frac{1}{n}\sum_{i}^{n}(y_{i} - \hat{y_{i}})^{2}\)</span></p></li>
</ul>
</div></blockquote>
</li>
<li><p>A mean squared error of zero is perfect</p></li>
<li><p>Any metric could be used, but mean squared error is very popular</p></li>
<li><p>One of the reasons it is used is because it <em>punishes</em> bigger errors more</p>
<blockquote>
<div><ul class="simple">
<li><p>If the difference between the observed and estimated value is 1, the squared error is 1</p></li>
<li><p>If the difference is 2, the error is 4</p></li>
<li><p>If it’s 3, the error is 9</p></li>
<li><p>…</p></li>
<li><p>In other words, it’s much worse to be very wrong than it is to be a little wrong</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">48</span><span class="k">def</span> <span class="nf">mean_squared_error</span><span class="p">(</span>
<span class="linenos">49</span>    <span class="n">compiled_individual</span><span class="p">,</span> <span class="n">independent_variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">dependent_variable</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<span class="linenos">50</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">51</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">52</span><span class="sd">    Calculate the mean squared error for a given function on the observed data. The independent variables are a list of</span>
<span class="linenos">53</span><span class="sd">    lists where the list of the outer list is the number of observations and the length of the inside list is the number</span>
<span class="linenos">54</span><span class="sd">    of independent variables. The length of the dependent variables is the number of observations.</span>
<span class="linenos">55</span>
<span class="linenos">56</span><span class="sd">    :param compiled_individual: A callable function that the dependent variables are give to as arguments</span>
<span class="linenos">57</span><span class="sd">    :param independent_variables: Values given to the function to predict</span>
<span class="linenos">58</span><span class="sd">    :param dependent_variable: Expected result of the function</span>
<span class="linenos">59</span><span class="sd">    :return: Mean squared error of the function on the observed data</span>
<span class="linenos">60</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">61</span>    <span class="n">running_error_squared_sum</span> <span class="o">=</span> <span class="mi">0</span>
<span class="linenos">62</span>    <span class="k">for</span> <span class="n">xs</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">independent_variables</span><span class="p">,</span> <span class="n">dependent_variable</span><span class="p">):</span>
<span class="linenos">63</span>        <span class="n">y_hat</span> <span class="o">=</span> <span class="n">compiled_individual</span><span class="p">(</span><span class="o">*</span><span class="n">xs</span><span class="p">)</span>
<span class="linenos">64</span>        <span class="n">running_error_squared_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">y_hat</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="linenos">65</span>    <span class="k">return</span> <span class="n">running_error_squared_sum</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">dependent_variable</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="language">
<h2><span class="section-number">13.5. </span>Language<a class="headerlink" href="#language" title="Link to this heading"></a></h2>
<ul>
<li><p>With symbolic regression, genetic programming will be searching the space of mathematical expressions</p></li>
<li><p>This includes both the operators and operands</p></li>
<li><p>The language is the set of operators and operands that the genetic programming system can use in the search</p></li>
<li><p>The trouble is, it’s not always clear which operators and operands should be included</p></li>
<li><p>Thus, the design of the language may need to be tuned for evolution like other hyperparameters</p></li>
<li><p>Fortunately, with symbolic regression, there is a common set to start with</p>
<blockquote>
<div><ul class="simple">
<li><p>Typical arithmatic operators</p></li>
<li><p>Maybe some trigonometry functions</p></li>
<li><p>Maybe logarithm and exponentials or even natural log and Euler’s number</p></li>
</ul>
</div></blockquote>
</li>
<li><p>However, there is a potential problem with divide as the evolutionary search may try to divide by zero</p></li>
<li><p>For this reason, it is common to see a <em>protected divide</em> used instead</p>
<blockquote>
<div><ul class="simple">
<li><p>If attempting to divide by zero, return infinity</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">33</span><span class="k">def</span> <span class="nf">protected_divide</span><span class="p">(</span><span class="n">dividend</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">divisor</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="linenos">34</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">35</span><span class="sd">    The basic arithmetic operator of division. If the division basic results in a ZeroDivisionError, this function</span>
<span class="linenos">36</span><span class="sd">    returns an arbitrarily large number (999,999,999).</span>
<span class="linenos">37</span>
<span class="linenos">38</span><span class="sd">    :param dividend: Value to divide</span>
<span class="linenos">39</span><span class="sd">    :param divisor: Value to divide by</span>
<span class="linenos">40</span><span class="sd">    :return: The quotient; the result of the division (dividend/divisor)</span>
<span class="linenos">41</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">42</span>    <span class="k">if</span> <span class="n">divisor</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">43</span>        <span class="k">return</span> <span class="n">math</span><span class="o">.</span><span class="n">inf</span>
<span class="linenos">44</span>    <span class="k">else</span><span class="p">:</span>
<span class="linenos">45</span>        <span class="k">return</span> <span class="n">dividend</span> <span class="o">/</span> <span class="n">divisor</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Setting up the language with DEAP is then done like below</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">104</span>    <span class="n">primitive_set</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">PrimitiveSet</span><span class="p">(</span><span class="s2">&quot;MAIN&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">independent_variables</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">105</span>    <span class="n">primitive_set</span><span class="o">.</span><span class="n">addPrimitive</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="linenos">106</span>    <span class="n">primitive_set</span><span class="o">.</span><span class="n">addPrimitive</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">sub</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="linenos">107</span>    <span class="n">primitive_set</span><span class="o">.</span><span class="n">addPrimitive</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">mul</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="linenos">108</span>    <span class="n">primitive_set</span><span class="o">.</span><span class="n">addPrimitive</span><span class="p">(</span><span class="n">protected_divide</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="linenos">109</span>    <span class="n">primitive_set</span><span class="o">.</span><span class="n">addPrimitive</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">neg</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="linenos">110</span>    <span class="n">primitive_set</span><span class="o">.</span><span class="n">addEphemeralConstant</span><span class="p">(</span><span class="s2">&quot;rand_int&quot;</span><span class="p">,</span> <span class="n">partial</span><span class="p">(</span><span class="n">randint</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<ul>
<li><p>The first line, creating the <code class="docutils literal notranslate"><span class="pre">PrimitiveSet</span></code> object, is where the language operators and operands will be added</p>
<blockquote>
<div><ul class="simple">
<li><p>It also specifies the number of independent variables the function will have as the second argument</p></li>
<li><p>As discussed above, the independent variables are stored in some list called <code class="docutils literal notranslate"><span class="pre">independent_variables</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Each operator is added to the primitive set object along with the number of operands that operator requires</p>
<blockquote>
<div><ul class="simple">
<li><p>The operator is the first argument, and is passed as a function</p></li>
<li><p>Most of the added operators in this example are taken from the <code class="docutils literal notranslate"><span class="pre">operator</span></code> library</p></li>
<li><p>The protected divide, described above, is also added</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">neg</span></code> operator is the negation (multiply by -1) and only requires one operand</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Finally, the constant values are added with <code class="docutils literal notranslate"><span class="pre">addEphemeralConstant</span></code></p>
<blockquote>
<div><ul class="simple">
<li><p>In this example, integers between -10 and 10 are eligible</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>There is no guarantee or suggestion that this is a <em>good</em> language, but it is at least a reasonable place to start.</p>
</div>
</section>
<section id="deap-setup">
<h2><span class="section-number">13.6. </span>DEAP Setup<a class="headerlink" href="#deap-setup" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>Below is an example of a setup for a DEAP algorithm</p></li>
<li><p>It effectively defines what each part of the algorithm will be</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">114</span>    <span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;FitnessMinimum&quot;</span><span class="p">,</span> <span class="n">base</span><span class="o">.</span><span class="n">Fitness</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,))</span>
<span class="linenos">115</span>    <span class="n">creator</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Individual&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">PrimitiveTree</span><span class="p">,</span> <span class="n">fitness</span><span class="o">=</span><span class="n">creator</span><span class="o">.</span><span class="n">FitnessMinimum</span><span class="p">)</span>
<span class="linenos">116</span>
<span class="linenos">117</span>    <span class="n">toolbox</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">Toolbox</span><span class="p">()</span>
<span class="linenos">118</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;generate_tree&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">genHalfAndHalf</span><span class="p">,</span> <span class="n">pset</span><span class="o">=</span><span class="n">primitive_set</span><span class="p">,</span> <span class="n">min_</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="linenos">119</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;individual&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">initIterate</span><span class="p">,</span> <span class="n">creator</span><span class="o">.</span><span class="n">Individual</span><span class="p">,</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">generate_tree</span><span class="p">)</span>
<span class="linenos">120</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;population&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">initRepeat</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">individual</span><span class="p">)</span>
<span class="linenos">121</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;compile&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">compile</span><span class="p">,</span> <span class="n">pset</span><span class="o">=</span><span class="n">primitive_set</span><span class="p">)</span>
<span class="linenos">122</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span>
<span class="linenos">123</span>        <span class="s2">&quot;evaluate&quot;</span><span class="p">,</span>
<span class="linenos">124</span>        <span class="n">mean_squared_error_fitness</span><span class="p">,</span>
<span class="linenos">125</span>        <span class="n">toolbox</span><span class="o">=</span><span class="n">toolbox</span><span class="p">,</span>
<span class="linenos">126</span>        <span class="n">independent_variables</span><span class="o">=</span><span class="n">independent_variables</span><span class="p">,</span>
<span class="linenos">127</span>        <span class="n">dependent_variable</span><span class="o">=</span><span class="n">dependent_variable</span><span class="p">,</span>
<span class="linenos">128</span>    <span class="p">)</span>
<span class="linenos">129</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;select&quot;</span><span class="p">,</span> <span class="n">tools</span><span class="o">.</span><span class="n">selTournament</span><span class="p">,</span> <span class="n">tournsize</span><span class="o">=</span><span class="n">TOURNAMENT_SIZE</span><span class="p">)</span>
<span class="linenos">130</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;mate&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">cxOnePoint</span><span class="p">)</span>
<span class="linenos">131</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;generate_mutation_subtree&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">genFull</span><span class="p">,</span> <span class="n">min_</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="linenos">132</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;mutate&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">mutUniform</span><span class="p">,</span> <span class="n">expr</span><span class="o">=</span><span class="n">toolbox</span><span class="o">.</span><span class="n">generate_mutation_subtree</span><span class="p">,</span> <span class="n">pset</span><span class="o">=</span><span class="n">primitive_set</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>This code</p>
<blockquote>
<div><ul>
<li><p>Sets the problem to be a minimization problem</p></li>
<li><p>Says how the individuals (chromosomes) will be encoded</p></li>
<li><p>Defines how the individuals and population will be generated</p></li>
<li><p>It defines the evaluation metric</p>
<blockquote>
<div><ul class="simple">
<li><p>Note that <code class="docutils literal notranslate"><span class="pre">mean_squared_error_fitness</span></code> is not the function described above</p></li>
<li><p>More on this below</p></li>
</ul>
</div></blockquote>
</li>
<li><p>It also sets the selection strategy and genetic operators</p></li>
</ul>
</div></blockquote>
</li>
<li><p>DEAP requires that the fitness function return a tuple of results</p></li>
<li><p>However, the above <code class="docutils literal notranslate"><span class="pre">mean_squared_error</span></code> function returns only a single value</p></li>
<li><p>Thus, another function, <code class="docutils literal notranslate"><span class="pre">mean_squared_error_fitness</span></code>, is created that calls <code class="docutils literal notranslate"><span class="pre">mean_squared_error</span></code></p></li>
<li><p>This function also</p>
<blockquote>
<div><ul class="simple">
<li><p>Checks if exceptions should be thrown</p></li>
<li><p><em>Compiles</em> the trees into something that can be functionally evaluated</p></li>
<li><p>Wraps the mean squared error in a tuple to be returned</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">68</span><span class="k">def</span> <span class="nf">mean_squared_error_fitness</span><span class="p">(</span>
<span class="linenos">69</span>    <span class="n">individual</span><span class="p">,</span> <span class="n">toolbox</span><span class="p">,</span> <span class="n">independent_variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]],</span> <span class="n">dependent_variable</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
<span class="linenos">70</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="linenos">71</span><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">72</span><span class="sd">    Calculate the mean squared error for a given function on the observed data. The independent variables are a list of</span>
<span class="linenos">73</span><span class="sd">    lists where the list of the outer list is the number of observations and the length of the inside list is the number</span>
<span class="linenos">74</span><span class="sd">    of independent variables. The length of the dependent variables is the number of observations.</span>
<span class="linenos">75</span>
<span class="linenos">76</span><span class="sd">    :param individual: A deap representation of a function that the dependent variables are give to as arguments</span>
<span class="linenos">77</span><span class="sd">    :param toolbox: A deap toolbox</span>
<span class="linenos">78</span><span class="sd">    :param independent_variables: Values given to the function to predict</span>
<span class="linenos">79</span><span class="sd">    :param dependent_variable: Expected result of the function</span>
<span class="linenos">80</span><span class="sd">    :return: A tuple containing the mean squared error of the function on the observed data</span>
<span class="linenos">81</span><span class="sd">    :raises ValueError: If the number of observations s 0 or if there are a different number of observations</span>
<span class="linenos">82</span><span class="sd">    &quot;&quot;&quot;</span>
<span class="linenos">83</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">independent_variables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dependent_variable</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="linenos">84</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of dependent and independent variables must be greater than 0&quot;</span><span class="p">)</span>
<span class="linenos">85</span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">independent_variables</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">dependent_variable</span><span class="p">):</span>
<span class="linenos">86</span>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="linenos">87</span>            <span class="sa">f</span><span class="s2">&quot;Uneven number of observations of independent and dependent variables: &quot;</span>
<span class="linenos">88</span>            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">independent_variables</span><span class="p">)</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">dependent_variable</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="linenos">89</span>        <span class="p">)</span>
<span class="linenos">90</span>    <span class="n">callable_function</span> <span class="o">=</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="n">individual</span><span class="p">)</span>
<span class="linenos">91</span>    <span class="n">individual_mean_squared_error</span> <span class="o">=</span> <span class="n">mean_squared_error</span><span class="p">(</span><span class="n">callable_function</span><span class="p">,</span> <span class="n">independent_variables</span><span class="p">,</span> <span class="n">dependent_variable</span><span class="p">)</span>
<span class="linenos">92</span>    <span class="k">return</span> <span class="p">(</span><span class="n">individual_mean_squared_error</span><span class="p">,)</span>
</pre></div>
</div>
<section id="bloat-control">
<h3><span class="section-number">13.6.1. </span>Bloat Control<a class="headerlink" href="#bloat-control" title="Link to this heading"></a></h3>
<ul>
<li><p>As mentioned in the previous topic, genetic programming suffers from <em>bloat</em></p>
<blockquote>
<div><ul class="simple">
<li><p>The trees tend to grow larger with no improvement in fitness</p></li>
<li><p>This negatively impacts the algorithm’s performance</p></li>
</ul>
</div></blockquote>
</li>
<li><p>DEAP provides simple ways to control bloat</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">136</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="s2">&quot;mate&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">staticLimit</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">),</span> <span class="n">max_value</span><span class="o">=</span><span class="n">MAX_HEIGHT</span><span class="p">))</span>
<span class="linenos">137</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="s2">&quot;mutate&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">staticLimit</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">),</span> <span class="n">max_value</span><span class="o">=</span><span class="n">MAX_HEIGHT</span><span class="p">))</span>
<span class="linenos">138</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="s2">&quot;mate&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">staticLimit</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">MAX_NODES</span><span class="p">))</span>
<span class="linenos">139</span>    <span class="n">toolbox</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="s2">&quot;mutate&quot;</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">staticLimit</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="nb">len</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="n">MAX_NODES</span><span class="p">))</span>
</pre></div>
</div>
<ul>
<li><p>The above sets limits on how deep and how many nodes a tree may have after a genetic operator is applied</p></li>
<li><p>These values may need to be adjusted to improve performance</p>
<blockquote>
<div><ul class="simple">
<li><p>If they are allowed to get too big, the search may take too long</p></li>
<li><p>If they are not allowed to get big enough, it may not be possible to model the data</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
<section id="bookkeeping">
<h3><span class="section-number">13.6.2. </span>Bookkeeping<a class="headerlink" href="#bookkeeping" title="Link to this heading"></a></h3>
<ul class="simple">
<li><p>DEAP also provides tools for keeping track of the results throughout evolution</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">143</span>    <span class="n">hall_of_fame</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">HallOfFame</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="linenos">144</span>    <span class="n">stats_fit</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Statistics</span><span class="p">(</span><span class="k">lambda</span> <span class="n">individual</span><span class="p">:</span> <span class="n">individual</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="linenos">145</span>    <span class="n">stats_size</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Statistics</span><span class="p">(</span><span class="nb">len</span><span class="p">)</span>
<span class="linenos">146</span>    <span class="n">stats_height</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">Statistics</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">))</span>
<span class="linenos">147</span>    <span class="n">mstats</span> <span class="o">=</span> <span class="n">tools</span><span class="o">.</span><span class="n">MultiStatistics</span><span class="p">(</span><span class="n">fitness</span><span class="o">=</span><span class="n">stats_fit</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">stats_size</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">stats_height</span><span class="p">)</span>
<span class="linenos">148</span>    <span class="n">mstats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;avg&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="linenos">149</span>    <span class="n">mstats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">std</span><span class="p">)</span>
<span class="linenos">150</span>    <span class="n">mstats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">)</span>
<span class="linenos">151</span>    <span class="n">mstats</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><p>The above code creates a <code class="docutils literal notranslate"><span class="pre">HallOfFame</span></code>, which will keep track of the top candidate solution for each generation</p></li>
<li><p>It also keeps track of some summary statistics on some population metrics</p>
<blockquote>
<div><ul class="simple">
<li><p>Population average, standard deviation, minimum, and maximum for fitness, tree height, and tree size</p></li>
<li><p>These values will be recorded for each generation</p></li>
</ul>
</div></blockquote>
</li>
</ul>
</section>
</section>
<section id="running-and-results">
<h2><span class="section-number">13.7. </span>Running and Results<a class="headerlink" href="#running-and-results" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p>After all the setup, running the algorithm is done as follows</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">155</span>    <span class="n">population</span> <span class="o">=</span> <span class="n">toolbox</span><span class="o">.</span><span class="n">population</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">POPULATION_SIZE</span><span class="p">)</span>
<span class="linenos">156</span>    <span class="n">population</span><span class="p">,</span> <span class="n">log</span> <span class="o">=</span> <span class="n">algorithms</span><span class="o">.</span><span class="n">eaSimple</span><span class="p">(</span>
<span class="linenos">157</span>        <span class="n">population</span><span class="p">,</span>
<span class="linenos">158</span>        <span class="n">toolbox</span><span class="p">,</span>
<span class="linenos">159</span>        <span class="n">CROSSOVER_RATE</span><span class="p">,</span>
<span class="linenos">160</span>        <span class="n">MUTATION_RATE</span><span class="p">,</span>
<span class="linenos">161</span>        <span class="n">GENERATIONS</span><span class="p">,</span>
<span class="linenos">162</span>        <span class="n">stats</span><span class="o">=</span><span class="n">mstats</span><span class="p">,</span>
<span class="linenos">163</span>        <span class="n">halloffame</span><span class="o">=</span><span class="n">hall_of_fame</span><span class="p">,</span>
<span class="linenos">164</span>        <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="linenos">165</span>    <span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>With the above settings, output like the following will be displayed</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>                                          fitness                                                      height                                             size
            -------------------------------------------------------------------     -------------------------------------------     -----------------------------------------------
gen nevals  avg             gen     max             min     nevals  std             avg     gen     max     min     nevals  std     avg     gen     max     min     nevals  std
0   10      3.07232e+08     0       2.98774e+09     472.225 10      8.93845e+08     2.3     0       4       1       10      1.1     10.2    0       30      2       10      9.67264
1   10      1.80136e+06     1       1.66745e+07     0.00906234      10      4.97235e+06     2.9     1       5       1       10      1.04403 9.7     1       26      2       10      7.0859
2   3       2331.57         2       13844.5         0.00906234      3       4034.1          2.8     2       3       2       3       0.4     6.7     2       12      4       3       2.75862
3   7       128527          3       1.26907e+06     0.00906234      7       380187          2.9     3       5       1       7       1.13578 6.9     3       14      2       7       3.53412

(rows 4 -- 96 omitted for brevity)

97  8       1.00691         97      1.00691         1.00691         8       0               0       97      0       0       8       0               1       97      1       1       8       0
98  8       86.9783         98      860.721         1.00691         8       257.914         0.1     98      1       0       8       0.3             1.2     98      3       1       8       0.6
99  7       1.00691         99      1.00691         1.00691         7       0               0       99      0       0       7       0               1       99      1       1       7       0
100 7       128571          100     1.2857e+06      1.00691         7       385711          0.2     100     2       0       7       0.6             1.3     100     4       1       7       0.9
</pre></div>
</div>
<ul>
<li><p>Viewing the results requires converting the tree to a string</p>
<blockquote>
<div><ul class="simple">
<li><p>It is possible to have DEAP generate and display images of the expression trees</p></li>
<li><p>Unfortunately, it can be difficult to get working</p></li>
</ul>
</div></blockquote>
</li>
<li><p>Below is an example of displaying the top result after evolution is complete</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos">169</span>    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hall_of_fame</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="linenos">170</span>    <span class="nb">print</span><span class="p">(</span><span class="n">hall_of_fame</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">fitness</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Below is an example result for a run of the GP</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>neg(neg(add(1, ARG0)))
(0.009062344161081039,)
</pre></div>
</div>
<ul class="simple">
<li><p>Given that <code class="docutils literal notranslate"><span class="pre">ARG0</span></code> is the only independent variable, the above can be simplified to <span class="math notranslate nohighlight">\(y = x + 1\)</span></p></li>
<li><p>The mean squared error of the model when applied to the data is roughly 0.00906</p></li>
</ul>
<section id="funny-results">
<h3><span class="section-number">13.7.1. </span>Funny Results<a class="headerlink" href="#funny-results" title="Link to this heading"></a></h3>
<ul>
<li><p>Given the stochastic nature of the search, the final result will differ every time</p></li>
<li><p>And since genetic programming’s only goal is to fit the data, and it does not attempt to simplify the results, some silly looking functions may be generated</p>
<blockquote>
<div><ul class="simple">
<li><p>Below are additional examples of generated solutions that all simplify to <span class="math notranslate nohighlight">\(y = x + 1\)</span></p></li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>sub(ARG0, protected_divide(ARG0, neg(ARG0)))
add(mul(protected_divide(ARG0, ARG0), protected_divide(ARG0, ARG0)), ARG0)
add(ARG0, protected_divide(ARG0, mul(7, protected_divide(ARG0, 7))))
add(-8, add(ARG0, 9))
add(mul(protected_divide(ARG0, ARG0), protected_divide(ARG0, ARG0)), mul(protected_divide(ARG0, 1), protected_divide(ARG0, ARG0)))
</pre></div>
</div>
</section>
</section>
<section id="for-next-class">
<h2><span class="section-number">13.8. </span>For Next Class<a class="headerlink" href="#for-next-class" title="Link to this heading"></a></h2>
<ul>
<li><p>Check out the following script</p>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference download internal" download="" href="../../_downloads/112500da10e652e2c302285d5d668db5/gp_symbolic_regression.py"><code class="xref download docutils literal notranslate"><span class="pre">Symbolic</span> <span class="pre">Regression</span> <span class="pre">with</span> <span class="pre">Genetic</span> <span class="pre">Programming</span></code></a></p></li>
</ul>
</div></blockquote>
</li>
<li><p><a class="reference external" href="https://deap.readthedocs.io/en/master/tutorials/advanced/gp.html">Read DEAP’s sample symbolic regression implementation</a></p></li>
<li><p><a class="reference external" href="https://deap.readthedocs.io/en/master/examples/index.html#genetic-programming-gp">Read through DEAP’s various genetic programming examples</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="genetic-programming.html" class="btn btn-neutral float-left" title="12. Genetic Programming" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="symbolic-regression-gp-experiment.html" class="btn btn-neutral float-right" title="14. Experimenting with Symbolic Regression" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, James Hughes &amp; Taras Mychaskiw.
      <span class="lastupdated">Last updated on Nov 17, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>